
import requests
import time
import random
import logging

# --- Configuration ---
TARGET_IP = "None"
BASE_URL = f"http://{TARGET_IP}"
TOTAL_REQUESTS = 60  
MIN_DELAY = 1.0
MAX_DELAY = 4.0

# Configure Logging
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - [USER] - %(message)s',
    datefmt='%H:%M:%S'
)

# Common paths a real user might visit
# Note: Included some that might 404 to simulate user error/old links
PATHS = [
    "/", 
    "/index.html", 
    "/about", 
    "/contact", 
    "/products", 
    "/services",
    "/login", 
    "/search?q=test"
]

# Realistic User-Agent strings (Chrome, Safari, Firefox)
USER_AGENTS = [
    "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.1.1 Safari/605.1.15",
    "Mozilla/5.0 (X11; Linux x86_64; rv:89.0) Gecko/20100101 Firefox/89.0"
]

def simulate_human_browsing():
    """Simulates a user browsing the site with realistic delays."""
    
    # Using a Session mimics a real browser (saves cookies, keep-alive connection)
    session = requests.Session()
    
    # Pick one browser identity for the whole session (users don't swap browsers mid-session)
    user_agent = random.choice(USER_AGENTS)
    session.headers.update({
        'User-Agent': user_agent,
        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
        'Connection': 'keep-alive'
    })

    logging.info(f"Starting session against {BASE_URL}")

    for i in range(TOTAL_REQUESTS):
        try:
            path = random.choice(PATHS)
            url = f"{BASE_URL}{path}"
            
            # Send Request
            response = session.get(url, timeout=5)
            
            # Log Result
            msg = f"[{i+1}/{TOTAL_REQUESTS}] Visited {path} | Status: {response.status_code}"
            if response.status_code == 200:
                logging.info(msg)
            else:
                # 404s are normal occasionally, but log as warning
                logging.warning(msg)

        except requests.exceptions.RequestException as e:
            logging.error(f"Connection failed: {e}")

        # --- Human Habit Simulation ---
        # 20% chance to 'read' the page (long delay)
        # 80% chance to click next link (short delay)
        if random.random() < 0.2:
            sleep_time = random.uniform(5.0, 8.0)
            logging.info(f"   (User is reading page... {sleep_time:.1f}s)")
        else:
            sleep_time = random.uniform(MIN_DELAY, MAX_DELAY)
        
        time.sleep(sleep_time)

    logging.info("Browsing session finished.")

if __name__ == "__main__":
    simulate_human_browsing()
